name: Release OpenList-magisk

on:
  push:
    tags:
      - "v*"

env:
  REPO_NAME: ${{ github.event.repository.name }}
  COMPILE_DATE: ${{ github.event.head_commit.timestamp }}

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        OpenWrt_ARCH: [arm64, x86_64]   # å¯æŒ‰éœ€è¦å¢åˆ 
    steps:
      # 1. æ‹‰æºç 
      - name: Checkout
        uses: actions/checkout@v4

      # 2. æ‰“åŒ…ï¼ˆä»… OpenList-magisk ç›®å½•ï¼‰
      - name: Zip OpenList-magisk
        run: |
          zip -r ${{ env.REPO_NAME }}-${{ matrix.OpenWrt_ARCH }}-release.zip \
                 OpenList-magisk/ -x "*.git*"

      # 3. ç”Ÿæˆè¯´æ˜æ–‡ä»¶
      - name: Generate release note
        run: |
          touch ${{ env.REPO_NAME }}-${{ matrix.OpenWrt_ARCH }}-release.txt
          cat <<EOF > ${{ env.REPO_NAME }}-${{ matrix.OpenWrt_ARCH }}-release.txt
      ğŸŒ ç®¡ç†åœ°å€: http://0.0.0.0:5244
      â±ï¸ ç¼–è¯‘æ—¶é—´: ${{ env.COMPILE_DATE }}
      ğŸ‘¤ ç”¨æˆ·å: admin
      ğŸ”‘ å¯†ç : KernelSUè‡ªè¡Œä¿®æ”¹
      # 4. åˆ›å»º Release å¹¶ä¸Šä¼ é™„ä»¶
      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          tag_name: ${{ github.ref_name }}
          name: ${{ github.ref_name }}-${{ matrix.OpenWrt_ARCH }}
          body_path: ${{ env.REPO_NAME }}-${{ matrix.OpenWrt_ARCH }}-release.txt
          files: |
            ${{ env.REPO_NAME }}-${{ matrix.OpenWrt_ARCH }}-release.zip
            ${{ env.REPO_NAME }}-${{ matrix.OpenWrt_ARCH }}-release.txt
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
